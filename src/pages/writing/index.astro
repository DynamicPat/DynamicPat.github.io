---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
const items = (await getCollection("posts")).sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
const tags = Array.from(new Set(items.flatMap(i => i.data.tags))).sort();
---
<BaseLayout title="Writing â€” Dynamic Pat" description="Essays, notes, and field guides.">
  <section class="container">
    <h1>Writing</h1>
    <p>Essays, notes, and field guides. <a href="/rss.xml">RSS feed</a></p>

    <div id="filters" style="display:flex; gap: var(--space-2); flex-wrap: wrap; margin-block: var(--space-3);">
      <button data-tag="all" class="tag-btn" aria-pressed="true">All</button>
      {tags.map(t => (<button data-tag={t} class="tag-btn" aria-pressed="false">{t}</button>))}
    </div>

    <ul id="post-list" style="list-style:none; padding:0; margin:0; display:grid; grid-template-columns: 1fr; gap: var(--space-3);">
      {items.map(({ data, slug }) => (
        <li class="card" data-tags={data.tags.join(",")}>
          <a href={`/writing/${slug}`} class="card__link">
            <h3 class="card__title">{data.title}</h3>
            <p class="card__summary">{data.summary}</p>
            <p class="card__meta">{new Date(data.date).toLocaleDateString()}</p>
          </a>
        </li>
      ))}
    </ul>
  </section>

  <script>
    const buttons = Array.from(document.querySelectorAll('.tag-btn'));
    const cards = Array.from(document.querySelectorAll('#post-list .card'));
    function setActive(tag) {
      buttons.forEach(b => b.setAttribute('aria-pressed', String(b.dataset.tag === tag)));
      cards.forEach(c => {
        const tags = (c.dataset.tags || '').split(',');
        const show = tag === 'all' || tags.includes(tag);
        c.style.display = show ? '' : 'none';
      });
    }
    buttons.forEach(b => b.addEventListener('click', () => setActive(b.dataset.tag)));
  </script>
</BaseLayout>
