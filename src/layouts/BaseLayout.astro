---
import Nav from "../components/Nav.astro";
import Footer from "../components/Footer.astro";
import site from "../../content/site.json";
import "../styles/tokens.css";
import "../styles/base.css";

interface Props {
  title?: string;
  description?: string;
}

const {
  title = site.name,
  description = site.tagline,
}: Props = Astro.props as Props;
const canonical = Astro.url.toString();
---

<html lang="en" data-theme="auto">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <link rel="canonical" href={canonical} />
    <meta name="description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonical} />
    <meta name="theme-color" content="#111111" media="(prefers-color-scheme: dark)" />
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />
    <link rel="icon" href="/favicon.svg" />
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml" />
  </head>
  <body>
    <canvas id="ambient-canvas" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; pointer-events:none;"></canvas>
    <a class="skip-link" href="#content">Skip to content</a>
    <Nav />
    <main id="content" class="container">
      <slot />
    </main>
    <Footer />

    <button id="ambient-toggle" style="position:fixed; bottom:var(--space-3); right:var(--space-3); padding:var(--space-2) var(--space-3); border-radius:999px; border:1px solid var(--border); background:var(--bg); color:var(--text); cursor:pointer; z-index:10;" aria-pressed="false">
      Enable ambient
    </button>

    <script>
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const saved = localStorage.getItem('theme');
      const initial = saved === 'light' || saved === 'dark' ? saved : (prefersDark ? 'dark' : 'light');
      document.documentElement.dataset.theme = initial;
      window.__setTheme = (t) => {
        document.documentElement.dataset.theme = t;
        localStorage.setItem('theme', t);
      };
    </script>
    <script src="../scripts/ambient.js"></script>
  </body>
</html>
